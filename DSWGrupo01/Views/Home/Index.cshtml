@model IEnumerable<DSWGrupo01.Models.ViniloModel>

@section Styles {
    <link rel="stylesheet" href="~/css/home.css" />
}

@if (TempData["Mensaje"] != null)
{
    <div class="container mt-4">
        <div class="alert alert-success alert-dismissible fade show text-center fw-semibold" role="alert">
            @TempData["Mensaje"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    </div>
}

<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-vinyl-icon">💿</div>
    <div class="hero-content">
        <h1 class="hero-title">Vinyl Paradise</h1>
        <p class="hero-subtitle">Descubre la magia del sonido analógico. Colecciones vintage y ediciones limitadas.</p>
        <a href="#catalog" class="hero-btn">Explorar Catálogo</a>
    </div>
</section>

<!-- Catalog Section -->
<section id="catalog" class="catalog-section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">🎵 Nuestro Catálogo</h2>
            <p class="section-subtitle">Explora nuestra selección curada de vinilos clásicos y contemporáneos</p>
        </div>

        <form method="get" class="search-container">
            <div class="d-flex gap-2">
                <input type="text"
                       name="q"
                       value="@ViewBag.Query"
                       class="form-control search-input flex-grow-1"
                       placeholder="Buscar por título o artista..." />
                <button type="submit" class="btn search-btn">Buscar</button>
            </div>
        </form>

        <div class="row g-4">
            @foreach (var item in Model)
            {
                <div class="col-md-6 col-lg-3">
                    <div class="vinyl-card">
                        <div class="vinyl-image-container">
                            <div class="vinyl-icon">♪</div>
                            <img src="@item.ImagenUrl"
                                 class="vinyl-image"
                                 alt="@item.Titulo" />
                            <div class="vinyl-overlay"></div>
                        </div>
                        <div class="vinyl-body">

                            <div class="vinyl-header">
                                <div class="vinyl-info">
                                    <h5 class="vinyl-title" title="@item.Titulo">@item.Titulo</h5>
                                    <p class="vinyl-artist">@item.Artista</p>
                                </div>

                                <!-- Botón Play/Pause -->
                                <button class="play-circle" onclick="toggleAudio(this)">►</button>

                                <audio class="hidden-audio">
                                    <source src="@item.Preview" type="audio/mp3" />
                                </audio>
                            </div>

                            <a asp-controller="Home"
                               asp-action="Detalle"
                               asp-route-id="@item.Id"
                               class="vinyl-btn">
                                Ver detalles
                            </a>
                        </div>


                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- About Section -->
<section class="about-section">
    <div class="about-container">
        <div class="about-image-wrapper">
            <img src="https://images.unsplash.com/photo-1603190287605-e6ade32fa852?w=800"
                 alt="Tienda de vinilos"
                 class="about-image" />
        </div>
        <div class="about-content">
            <h2>Nuestra Historia</h2>
            <h3>Más de 20 años compartiendo la pasión por el vinilo</h3>
            <p>
                En Vinyl Paradise, creemos que la música merece ser escuchada en su forma más pura.
                Desde 2003, nos hemos dedicado a rescatar, preservar y compartir la magia del formato analógico.
            </p>
            <p>
                Cada vinilo en nuestra tienda es cuidadosamente seleccionado, verificado y catalogado
                para garantizar que recibas no solo un disco, sino una experiencia auditiva excepcional.
            </p>

            <div class="about-features">
                <div class="feature-item">
                    <div class="feature-icon">✓</div>
                    <div class="feature-text">
                        <h4>Autenticidad Garantizada</h4>
                        <p>Todos nuestros vinilos son originales y verificados</p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">🎵</div>
                    <div class="feature-text">
                        <h4>Colección Curada</h4>
                        <p>Selección experta de clásicos y rarezas</p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">📦</div>
                    <div class="feature-text">
                        <h4>Envío Seguro</h4>
                        <p>Empaque especializado para proteger tu compra</p>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">💬</div>
                    <div class="feature-text">
                        <h4>Asesoría Personalizada</h4>
                        <p>Te ayudamos a encontrar el vinilo perfecto</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    const MAX_DURATION = 10; // Máximo de segundos permitidos

    function toggleAudio(button) {
        const audio = button.nextElementSibling;

        if (audio.paused) {
            audio.play();
            button.textContent = '❚❚';

            const limiter = setInterval(() => {
                if (audio.currentTime >= MAX_DURATION) {
                    audio.pause();
                    audio.currentTime = 0;
                    button.textContent = '►';
                    clearInterval(limiter);
                }
            }, 200);

            audio.limiter = limiter;

        } else {
            audio.pause();
            button.textContent = '►';
            if (audio.limiter) clearInterval(audio.limiter);
        }

        audio.onended = () => {
            button.textContent = '►';
            if (audio.limiter) clearInterval(audio.limiter);
        };
    }
</script>